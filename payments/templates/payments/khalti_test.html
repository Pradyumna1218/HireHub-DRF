<!DOCTYPE html>
<html>
<head>
    <title>Khalti Sandbox Payment</title>
    <script src="https://khalti.com/static/khalti-checkout.js"></script>
</head>
<body>
    <h2>Pay with Khalti (Sandbox)</h2>
    <button id="payment-button">Pay with Khalti</button>

    <script>
        var config = {
            publicKey: "test_public_key_4aee3ae5ff17465e8d467273ba5a5bba", 
            productIdentity: "1234567890",
            productName: "Order Payment",
            productUrl: "http://example.com/product",
            paymentPreference: ["KHALTI"],

            eventHandler: {
                onSuccess(payload) {
                    console.log("Payment success payload:", payload);

                    fetch("http://localhost:8000/khalti/verify/2/", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQ2NTE2OTM3LCJpYXQiOjE3NDY1MTY2MzcsImp0aSI6IjQ0ZTJkYTJiNzI1NDQyYzJiZGZlYTdhNzUzZjJmNzU2IiwidXNlcl9pZCI6MTR9.asE5ZjcSOUp0Hr0uCwtyOnYKxeRNFf5R34gWIIQW7wQ"  
                        },
                        body: JSON.stringify({
                            token: payload.token,
                            amount: payload.amount
                        })
                    })
                    .then(res => res.json())
                    .then(data => {
                        console.log("Verification response:", data);
                        alert("Payment verification: " + JSON.stringify(data));
                    })
                    .catch(err => {
                        console.error("Verification error:", err);
                        alert("Verification failed");
                    });
                },
                onError(error) {
                    console.error("Payment error:", error);
                    alert("Payment failed");
                },
                onClose() {
                    console.log("Khalti widget closed");
                }
            }
        };

        var checkout = new KhaltiCheckout(config);
        document.getElementById("payment-button").onclick = function () {
            checkout.show({ amount: 45000 });
        };
    </script>
</body>
</html>
